// define("local_da_courses/qaedit",["core/ajax","core/notification"],function(Ajax,Notification){"use strict";function startEdit(li){var qSpan=li.querySelector(".qa-qtext"),aSpan=li.querySelector(".qa-atext"),oldQ=qSpan?qSpan.textContent:"",oldA=aSpan?aSpan.textContent:"";var qTa=document.createElement("textarea");qTa.className="form-control qa-qta";qTa.value=oldQ;var aTa=document.createElement("textarea");aTa.className="form-control qa-ata";aTa.value=oldA;qSpan&&qSpan.replaceWith(qTa);aSpan&&aSpan.replaceWith(aTa);var actions=li.querySelector(".qa-actions");actions.innerHTML="";var save=document.createElement("button");save.className="btn btn-primary qa-save";save.textContent="Save";var cancel=document.createElement("button");cancel.className="btn btn-secondary ml-1 qa-cancel";cancel.textContent="Cancel";actions.append(save,cancel);save.addEventListener("click",function(){doSave(li,qTa.value,aTa.value)});cancel.addEventListener("click",function(){cancelEdit(li,qTa,aTa,oldQ,oldA)})}function cancelEdit(li,qTa,aTa,oldQ,oldA){var qSpan=document.createElement("span");qSpan.className="qa-qtext";qSpan.textContent=oldQ;var aSpan=document.createElement("span");aSpan.className="qa-atext";aSpan.textContent=oldA;qTa.replaceWith(qSpan);aTa.replaceWith(aSpan);var actions=li.querySelector(".qa-actions");actions.innerHTML='<button class="btn btn-secondary qa-edit">Edit</button>';var btn=actions.querySelector(".qa-edit");btn&&btn.addEventListener("click",function(){startEdit(li)})}function doSave(li,qNew,aNew){var id=parseInt(li.dataset.qaid,10);var req=Ajax.call([{methodname:"local_da_courses_update_qa",args:{id:id,qtext:qNew,atext:aNew}}])[0];req.then(function(res){var qSpan=document.createElement("span");qSpan.className="qa-qtext";qSpan.textContent=res.qtext;var aSpan=document.createElement("span");aSpan.className="qa-atext";aSpan.textContent=res.atext;var oldQ=li.querySelector(".qa-qta"),oldA=li.querySelector(".qa-ata");oldQ&&oldQ.replaceWith(qSpan);oldA&&oldA.replaceWith(aSpan);var actions=li.querySelector(".qa-actions");actions.innerHTML='<span class="text-success">Saved</span> <button class="btn btn-secondary ml-1 qa-edit">Edit</button>';var btn=actions.querySelector(".qa-edit");btn&&btn.addEventListener("click",function(){startEdit(li)})}).catch(Notification.exception)}function init(){document.querySelectorAll(".qa-edit").forEach(function(btn){btn.addEventListener("click",function(){var li=btn.closest("li[data-qaid]");li&&startEdit(li)})})}return{init:init}});
define("local_da_courses/qaedit", ["core/ajax", "core/notification"], function (Ajax, Notification) {
    "use strict";
    function startEdit(li) {
        var qSpan = li.querySelector(".qa-qtext"),
            aSpan = li.querySelector(".qa-atext"),
            oldQ = qSpan ? qSpan.textContent : "",
            oldA = aSpan ? aSpan.textContent : "";
        var qTa = document.createElement("textarea");
        qTa.className = "form-control qa-qta";
        qTa.value = oldQ;
        var aTa = document.createElement("textarea");
        aTa.className = "form-control qa-ata";
        aTa.value = oldA;
        qSpan && qSpan.replaceWith(qTa);
        aSpan && aSpan.replaceWith(aTa);
        var actions = li.querySelector(".qa-actions");
        actions.innerHTML = "";
        var save = document.createElement("button");
        save.className = "btn btn-primary qa-save";
        save.textContent = "Save";
        var cancel = document.createElement("button");
        cancel.className = "btn btn-secondary ml-1 qa-cancel";
        cancel.textContent = "Cancel";
        actions.append(save, cancel);
        save.addEventListener("click", function () {
            doSave(li, qTa.value, aTa.value);
        });
        cancel.addEventListener("click", function () {
            cancelEdit(li, qTa, aTa, oldQ, oldA);
        });
    }
    function cancelEdit(li, qTa, aTa, oldQ, oldA) {
        var qSpan = document.createElement("span");
        qSpan.className = "qa-qtext";
        qSpan.textContent = oldQ;
        var aSpan = document.createElement("span");
        aSpan.className = "qa-atext";
        aSpan.textContent = oldA;
        qTa.replaceWith(qSpan);
        aTa.replaceWith(aSpan);
        var actions = li.querySelector(".qa-actions");
        actions.innerHTML = '<button class="btn btn-secondary qa-edit">Edit</button>';
        var btn = actions.querySelector(".qa-edit");
        btn &&
            btn.addEventListener("click", function () {
                startEdit(li);
            });
    }
    function doSave(li, qNew, aNew) {
        var id = parseInt(li.dataset.qaid, 10);
        var req = Ajax.call([{ methodname: "local_da_courses_update_qa", args: { id: id, qtext: qNew, atext: aNew } }])[0];
        req.then(function (res) {
            var qSpan = document.createElement("span");
            qSpan.className = "qa-qtext";
            qSpan.textContent = res.qtext;
            var aSpan = document.createElement("span");
            aSpan.className = "qa-atext";
            aSpan.textContent = res.atext;
            var oldQ = li.querySelector(".qa-qta"),
                oldA = li.querySelector(".qa-ata");
            oldQ && oldQ.replaceWith(qSpan);
            oldA && oldA.replaceWith(aSpan);
            var actions = li.querySelector(".qa-actions");
            actions.innerHTML = '<span class="text-success">Saved</span> <button class="btn btn-secondary ml-1 qa-edit">Edit</button>';
            var btn = actions.querySelector(".qa-edit");
            btn &&
                btn.addEventListener("click", function () {
                    startEdit(li);
                });
        }).catch(Notification.exception);
    }
    function init() {
        document.querySelectorAll(".qa-edit").forEach(function (btn) {
            btn.addEventListener("click", function () {
                var li = btn.closest("li[data-qaid]");
                li && startEdit(li);
            });
        });
    }
    return { init: init };
});

